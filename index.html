<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Vegan Recipes</title>

    <!-- SEO & Social Meta Tags -->
    <meta name="description" content="Find fresh daily vegan recipes from top bloggers. Filter by meals, sweets, and protein. Updated every day.">
    <meta property="og:title" content="Daily Vegan Recipes">
    <meta property="og:description" content="Daily recipes from the top bloggers">
    <meta property="og:image" content="https://findvegdish.com/default.jpg"> 
    <meta property="og:url" content="https://findvegdish.com">
    <meta property="og:type" content="website">
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">

    <link rel="icon" href="https://findvegdish.com/icon.jpg" type="image/jpeg"> 
    <link rel="apple-touch-icon" href="https://findvegdish.com/icon.jpg">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 20px;
            padding-bottom: 60px;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo-link {
            display: inline-block;
            cursor: pointer;
            text-decoration: none;
            border: none;
            background: none;
        }

        .logo-img {
            max-width: 90%;
            width: 350px;
            height: auto;
            display: block;
            margin: 0 auto 3px auto;
            transition: transform 0.2s;
        }
        
        .logo-link:active .logo-img {
            transform: scale(0.98); 
        }
        .sub-intro {
            text-align: center;
            font-size: 0.9em;
            font-weight: 400;
            color: #888; 
            margin: -5px 0 15px 0; 
        }

        @media (max-width: 400px) {
            .sub-intro { font-size: 0.85em; }
        }
        
        .search-wrapper {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 10px auto;
        }

        #searchInput {
            padding: 12px 45px 12px 20px;
            width: 100%;
            box-sizing: border-box;
            border-radius: 25px;
            border: 1px solid #ddd;
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            outline: none;
            transition: all 0.3s ease;
            color: #769F37; 
            font-weight: 600;
        }
        #searchInput:focus {
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border-color: #769F37;
        }
        #searchInput::placeholder {
            color: #aaa;
            font-weight: 400;
        }

        #clearBtn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 18px;
            color: #aaa;
            cursor: pointer;
            display: none;
            padding: 5px;
        }
        #clearBtn:hover { color: #555; }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: nowrap; 
            margin-top: 20px;
        }

        @media (max-width: 500px) {
            .controls .btn {
                padding: 8px 12px; 
                font-size: 12px;   
                gap: 3px;          
            }
        }

        .btn {
            padding: 10px 20px;
            border-radius: 25px;
            border: none;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.1s, background 0.2s, color 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            color: #555;
            background-color: white;
            border: 1px solid #ddd;
            -webkit-tap-highlight-color: transparent; 
        }
        @media (hover: hover) {
               .btn:hover { background-color: #f0f0f0; }
        }
        .btn:active { 
            transform: scale(0.95); 
            background-color: #e0e0e0;
        }

        .btn.active-filter {
            background-color: #769F37 !important; 
            color: white !important;
            border-color: #769F37 !important;
        }
        #shuffleBtn {
            border: 1px solid #769F37; 
            font-weight: 600;
            color: #555;
            background-color: white;
        }

        #installBtn {
            display: none;
            background-color: #2c3e50;
            color: white;
            border: none;
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            margin-top: 30px;
            grid-auto-flow: row; 
        }
        
        @media (max-width: 1100px) { .gallery { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 800px) { .gallery { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 500px) { .gallery { grid-template-columns: 1fr; } }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            overflow: hidden;
            display: flex;
            flex-direction: column; 
            text-decoration: none;
            color: inherit;
            position: relative;
            animation: fadeIn 0.5s ease-in;
            height: 100%;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }
        
        .card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            display: block;
        }
        
        /* Updated Share Button to act like a button */
        .share-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 10;
            transition: transform 0.2s, background 0.2s;
            border: none;
            outline: none;
            padding: 0;
        }
        .share-btn:hover { transform: scale(1.1); background-color: #f0f0f0; }
        .share-btn svg { width: 22px; height: 22px; fill: #555; }

        .info { 
            padding: 15px; 
            display: flex;
            flex-direction: column;
            flex-grow: 1; 
            align-items: flex-start; 
        }
        
        .meta-row {
            display: flex;
            align-items: center;
            gap: 8px; 
            margin-bottom: 5px;
            width: 100%;
            flex-wrap: wrap; 
        }
        
        .tag {
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #769F37; 
            font-weight: 600;
            display: inline-block;
        }
        .disruptor-tag { color: #e67e22; }
        
        .fresh-badge, .wfpb-badge, .easy-badge {
            color: white;
            font-size: 0.7em;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
            text-transform: uppercase;
            white-space: nowrap;
        }
        
        .fresh-badge {
            background-color: #769F37; 
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; }
        }

        .wfpb-badge { background-color: #16a085; }
        .easy-badge { background-color: #2980b9; }

        .title {
            font-size: 1.1em;
            font-weight: 600;
            line-height: 1.4;
            margin: 5px 0;
            color: #333;
            /* Line Clamping - Max 2 lines */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .blogger { font-size: 0.9em; color: #888; margin-top: auto; padding-top: 10px; }
        
        /* No Results Message */
        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            font-size: 1.2em;
            color: #888;
            margin-top: 40px;
        }

        footer { text-align: center; margin-top: 50px; color: #aaa; font-size: 0.9em; }
        #loader { text-align: center; padding: 20px; color: #888; font-style: italic; display: none; }

        #scrollTopBtn {
            display: none; 
            position: fixed;
            bottom: 100px;
            right: 25px;
            z-index: 99;
            width: 50px;
            height: 50px;
            border: none;
            outline: none;
            background-color: #769F37;
            color: white;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: background-color 0.3s, transform 0.3s;
            align-items: center;
            justify-content: center;
        }
        #scrollTopBtn:hover {
            background-color: #5d822b; 
            transform: translateY(-3px);
        }
        @media (max-width: 400px) {
            #scrollTopBtn { bottom: 90px; right: 20px; width: 45px; height: 45px; }
        }
    </style>
</head>
<body>

<header>
    <!-- Logo -->
    <a href="index.html" class="logo-link" title="Refresh">
        <img src="default.jpg" alt="Daily Vegan Recipes" class="logo-img">
    </a>
    
    <p class="sub-intro">Explore the newest recipes from over 50 top blogs</p>
    
    <!-- Search Bar -->
    <div class="search-wrapper">
        <label for="searchInput" style="display:none;">Search Recipes</label>
        <input type="text" id="searchInput" placeholder="Search: Easy, Soup, Cake, Tofu...">
        <button id="clearBtn" title="Clear Search">‚úï</button>
    </div>

    <div class="controls">
        <button class="btn" id="mealsBtn" onclick="toggleCategory('meal')">üçù Meals</button>
        <button class="btn" id="sweetsBtn" onclick="toggleCategory('sweet')">üç™ Sweets</button>
        <button class="btn" id="proteinBtn" onclick="toggleCategory('protein')">‚¨ÜÔ∏è Protein</button>
        <button class="btn" id="shuffleBtn" onclick="shuffleRecipes()">üîÄ Shuffle</button>
    </div>
</header>

<div id="gallery" class="gallery"></div>
<div id="loader">Loading more recipes...</div>

<button id="scrollTopBtn" title="Go to top" aria-label="Scroll to top">
    <svg viewBox="0 0 24 24" width="24" height="24" fill="white">
        <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
    </svg>
</button>

<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="natethevegan" data-description="Support me on Buy me a coffee!" data-message="" data-color="#769F37" data-position="Right" data-x_margin="18" data-y_margin="18"></script>

<footer>
    <p>All recipes and images belong to respective authors.</p>
</footer>

<script>
    // --- GLOBAL STATE ---
    let allRecipes = [];          
    let currentContext = [];      
    let renderedCount = 0;        
    let activeCategory = null;    
    const BATCH_SIZE = 48;        

    // --- KEYWORDS ---
    const SWEET_KEYWORDS = ['cookie', 'cake', 'brownie', 'chocolate', 'dessert', 'pie', 'tart', 'muffin', 'donut', 'doughnut', 'ice cream', 'pudding', 'cheesecake', 'sweet', 'fudge', 'truffle', 'bar', 'cupcake', 'blondie', 'galette', 'cobbler', 'mousse', 'cinnamon roll', 'scone', 'waffle', 'pancake'];
    const MEAL_KEYWORDS = ['pasta', 'burger', 'curry', 'soup', 'stew', 'taco', 'pizza', 'sandwich', 'wrap', 'salad', 'bowl', 'rice', 'noodle', 'stir fry', 'lasagna', 'casserole', 'tofu', 'tempeh', 'lentil', 'chickpea', 'potato', 'dinner', 'lunch', 'roast', 'chili', 'shepherd', 'risotto', 'gnocchi', 'quiche', 'enchilada', 'burrito', 'quesadilla', 'mac and cheese', 'dumpling', 'meatball', 'loaf', 'skillet', 'gratin', 'pad thai', 'ramen'];
    const PROTEIN_KEYWORDS = ['tofu', 'tempeh', 'seitan', 'tvp', 'lentil', 'bean', 'chickpea', 'edamame', 'soy', 'quinoa', 'peanut', 'meatball', 'burger', 'sausage', 'protein', 'falafel', 'hummus', 'nut roast'];

    // --- UTILS ---
    // Debounce function to limit how often search runs
    function debounce(func, wait) {
        let timeout;
        return function(...args) {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), wait);
        };
    }

    // --- INITIALIZATION ---
    fetch('data.json')
        .then(response => response.json())
        .then(data => {
            allRecipes = data;
            currentContext = allRecipes; 
            renderNextBatch();           
            setupInfiniteScroll();       
        })
        .catch(error => {
            console.error('Error loading data:', error);
            document.getElementById('gallery').innerHTML = '<p style="text-align:center">Could not load recipes.</p>';
        });

    // --- RENDER LOGIC (BATCHED) ---
    function renderNextBatch() {
        const gallery = document.getElementById('gallery');
        const loader = document.getElementById('loader');
        
        // Empty State Check
        if (currentContext.length === 0) {
            gallery.innerHTML = '<div class="no-results">No recipes found. Try a different keyword!</div>';
            loader.style.display = 'none';
            return;
        }

        if (renderedCount >= currentContext.length) {
            loader.style.display = 'none';
            return;
        }

        const nextBatch = currentContext.slice(renderedCount, renderedCount + BATCH_SIZE);
        
        nextBatch.forEach(recipe => {
            const card = createCard(recipe);
            gallery.appendChild(card);
        });

        renderedCount += nextBatch.length;
        
        if (renderedCount < currentContext.length) {
            loader.style.display = 'block';
        } else {
            loader.style.display = 'none';
        }
    }

    function createCard(recipe) {
        const card = document.createElement('a');
        card.className = 'card';
        card.href = recipe.link;
        card.target = "_blank"; 
        card.rel = "noopener noreferrer"; // Security best practice

        const img = document.createElement('img');
        img.src = recipe.image;
        img.alt = recipe.title; // Accessibility
        // Fix infinite loop if icon.jpg also fails
        img.onerror = function() { 
            this.onerror = null; 
            this.src = 'icon.jpg'; 
        };
        img.loading = "lazy"; 

        const info = document.createElement('div');
        info.className = 'info';

        let tagClass = 'tag';
        let tagText = 'Top Blog';
        if(recipe.is_disruptor) {
            tagClass += ' disruptor-tag';
            tagText = 'Rising Blog';
        }

        const recipeDate = new Date(recipe.date);
        const now = new Date();
        const daysOld = (now - recipeDate) / (1000 * 3600 * 24);
        
        let badgeHTML = '';

        if (daysOld < 2) {
            badgeHTML += '<span class="fresh-badge">New Today</span>';
        }

        if (recipe.special_tags && Array.isArray(recipe.special_tags)) {
            recipe.special_tags.forEach(tag => {
                if (tag === 'WFPB') {
                    badgeHTML += '<span class="wfpb-badge">WFPB</span>';
                } else if (tag === 'Easy') {
                    badgeHTML += '<span class="easy-badge">Easy</span>';
                }
            });
        }
        
        info.innerHTML = `
            <div class="meta-row">
                <span class="${tagClass}">${tagText}</span>
                ${badgeHTML}
            </div>
            <div class="title" title="${recipe.title}">${recipe.title}</div>
            <div class="blogger">by ${recipe.blog_name}</div>
        `;

        // Changed div to button for accessibility
        const shareBtn = document.createElement('button');
        shareBtn.className = 'share-btn';
        shareBtn.ariaLabel = "Share Recipe";
        shareBtn.innerHTML = `<svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>`;
        shareBtn.onclick = (e) => shareRecipe(e, recipe.title, recipe.link);

        card.appendChild(shareBtn);
        card.appendChild(img);
        card.appendChild(info);
        return card;
    }

    // --- INFINITE SCROLL HANDLER ---
    function setupInfiniteScroll() {
        window.addEventListener('scroll', () => {
            const scrollBtn = document.getElementById("scrollTopBtn");
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                scrollBtn.style.display = "flex";
            } else {
                scrollBtn.style.display = "none";
            }
            if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 500) {
                if (renderedCount < currentContext.length) {
                    renderNextBatch();
                }
            }
        });
        document.getElementById("scrollTopBtn").addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    }

    // --- RESET VIEW FUNCTION ---
    function resetView(newContext) {
        currentContext = newContext;
        renderedCount = 0;
        document.getElementById('gallery').innerHTML = '';
        window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to top on filter change
        renderNextBatch();
    }

    // --- SHUFFLE FUNCTION ---
    function shuffleRecipes() {
        document.activeElement.blur(); 
        for (let i = allRecipes.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [allRecipes[i], allRecipes[j]] = [allRecipes[j], allRecipes[i]];
        }
        activeCategory = null;
        document.getElementById('mealsBtn').classList.remove('active-filter');
        document.getElementById('sweetsBtn').classList.remove('active-filter');
        document.getElementById('proteinBtn').classList.remove('active-filter');
        resetView(allRecipes);
    }

    // --- FILTER/SEARCH LOGIC ---
    function applyFilters() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        let filtered = allRecipes;

        if (term.length > 0) {
            filtered = filtered.filter(recipe => {
                const title = recipe.title.toLowerCase();
                const blogger = recipe.blog_name.toLowerCase();
                let hasMatchingTag = false;
                if (recipe.special_tags && Array.isArray(recipe.special_tags)) {
                    hasMatchingTag = recipe.special_tags.some(tag => tag.toLowerCase().includes(term));
                }
                
                return title.includes(term) || blogger.includes(term) || hasMatchingTag;
            });
        }

        if (activeCategory === 'sweet') {
            filtered = filtered.filter(recipe => {
                const t = recipe.title.toLowerCase();
                const hasKeyword = SWEET_KEYWORDS.some(k => t.includes(k));
                const isSavory = t.includes('sweet potato') || t.includes('sweet and sour');
                return hasKeyword && !isSavory;
            });
        } else if (activeCategory === 'meal') {
            filtered = filtered.filter(recipe => {
                const t = recipe.title.toLowerCase();
                const hasKeyword = MEAL_KEYWORDS.some(k => t.includes(k));
                const isSide = t.includes('sauce') || t.includes('dressing') || t.includes('side');
                return hasKeyword && !isSide;
            });
        } else if (activeCategory === 'protein') {
            filtered = filtered.filter(recipe => {
                const t = recipe.title.toLowerCase();
                return PROTEIN_KEYWORDS.some(k => t.includes(k));
            });
        }

        resetView(filtered); // Reuse resetView to handle scroll and clearing
    }

    // --- SEARCH DEBOUNCE ---
    const processSearchChange = debounce(() => {
        applyFilters();
    }, 300);

    // --- CATEGORY TOGGLE ---
    function toggleCategory(category) {
        document.activeElement.blur(); 
        const mealsBtn = document.getElementById('mealsBtn');
        const sweetsBtn = document.getElementById('sweetsBtn');
        const proteinBtn = document.getElementById('proteinBtn');

        if (activeCategory === category) {
            activeCategory = null;
            mealsBtn.classList.remove('active-filter');
            sweetsBtn.classList.remove('active-filter');
            proteinBtn.classList.remove('active-filter');
        } else {
            activeCategory = category;
            mealsBtn.classList.remove('active-filter');
            sweetsBtn.classList.remove('active-filter');
            proteinBtn.classList.remove('active-filter');

            if(category === 'meal') mealsBtn.classList.add('active-filter');
            else if(category === 'sweet') sweetsBtn.classList.add('active-filter');
            else if(category === 'protein') proteinBtn.classList.add('active-filter');
        }
        applyFilters();
    }

    // --- SEARCH INPUT LISTENERS ---
    const searchInput = document.getElementById('searchInput');
    const clearBtn = document.getElementById('clearBtn');

    searchInput.addEventListener('keyup', () => {
        clearBtn.style.display = searchInput.value.length > 0 ? 'block' : 'none';
        processSearchChange(); // Using Debounce
    });

    clearBtn.addEventListener('click', () => {
        searchInput.value = '';
        searchInput.focus();
        clearBtn.style.display = 'none';
        applyFilters(); // Instant clear (no debounce needed)
    });

    // --- INSTALL & SHARE ---
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.style.display = 'inline-block';
    });
    installBtn.addEventListener('click', (e) => {
        installBtn.style.display = 'none';
        deferredPrompt.prompt();
        deferredPrompt = null;
    });

    function shareRecipe(e, title, link) {
        e.preventDefault(); 
        e.stopPropagation(); 
        if (navigator.share) {
            navigator.share({ title: title, url: link }).catch(console.error);
        } else {
            navigator.clipboard.writeText(link);
            alert("Link copied to clipboard!");
        }
    }
</script>

</body>
</html>
