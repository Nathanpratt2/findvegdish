<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Vegan Recipes</title>

    <meta property="og:title" content="Daily Vegan Recipes">
    <meta property="og:description" content="Daily recipes from the top bloggers">
    <meta property="og:image" content="https://findvegdish.com/default.jpg"> 
    <meta property="og:url" content="https://findvegdish.com">
    <meta property="og:type" content="website">
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">

    <!-- Browser Icons -->
    <!-- Use Full URLs here too for maximum compatibility -->
    <link rel="icon" href="https://findvegdish.com/icon.jpg" type="image/jpeg"> 
    <link rel="apple-touch-icon" href="https://findvegdish.com/icon.jpg">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 20px;
            padding-bottom: 60px;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo-img {
            max-width: 90%;
            width: 350px;
            height: auto;
            display: block;
            margin: 0 auto 15px auto;
        }

        /* Search Bar Wrapper */
        .search-wrapper {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 10px auto;
        }

        #searchInput {
            padding: 12px 45px 12px 20px;
            width: 100%;
            box-sizing: border-box;
            border-radius: 25px;
            border: 1px solid #ddd;
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            outline: none;
            transition: all 0.3s ease;
            color: #27ae60; 
            font-weight: 600;
        }
        #searchInput:focus {
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border-color: #27ae60;
        }
        #searchInput::placeholder {
            color: #aaa;
            font-weight: 400;
        }

        #clearBtn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 18px;
            color: #aaa;
            cursor: pointer;
            display: none;
            padding: 5px;
        }
        #clearBtn:hover { color: #555; }

        /* Controls Container */
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        /* General Button Style */
        .btn {
            padding: 10px 20px;
            border-radius: 25px;
            border: none;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s, background 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            color: #555;
            background-color: white;
            border: 1px solid #ddd;
        }
        .btn:active { transform: scale(0.95); }
        .btn:hover { background-color: #f0f0f0; }

        /* Active State for Filter Buttons */
        .btn.active-filter {
            background-color: #2c3e50;
            color: white;
            border-color: #2c3e50;
        }

        #installBtn {
            display: none;
            background-color: #2c3e50;
            color: white;
            border: none;
        }

        /* --- UPDATED GRID LAYOUT --- */
        .gallery {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            margin-top: 30px;
            grid-auto-flow: row; 
        }
        
        @media (max-width: 1100px) { .gallery { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 800px) { .gallery { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 500px) { .gallery { grid-template-columns: 1fr; } }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            overflow: hidden;
            display: flex;
            flex-direction: column; 
            text-decoration: none;
            color: inherit;
            position: relative;
            animation: fadeIn 0.5s ease-in;
            height: 100%;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }
        
        .card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            display: block;
        }
        
        .share-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 10;
            transition: transform 0.2s, background 0.2s;
        }
        .share-btn:hover { transform: scale(1.1); background-color: #f0f0f0; }
        .share-btn svg { width: 22px; height: 22px; fill: #555; }

        .info { 
            padding: 15px; 
            display: flex;
            flex-direction: column;
            flex-grow: 1; 
            /* Fixes stretched items */
            align-items: flex-start; 
        }
        
        /* NEW: Wrapper for Tag and Badge */
        .meta-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
            width: 100%;
        }
        
        .tag {
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #27ae60; 
            font-weight: bold;
            display: inline-block;
        }
        .disruptor-tag { color: #e67e22; }
        
        /* UPDATED: Green Badge */
        .fresh-badge {
            background-color: #27ae60; /* Changed to Green */
            color: white;
            font-size: 0.7em;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
            text-transform: uppercase;
            animation: pulse 2s infinite;
            white-space: nowrap; /* Prevents text squishing */
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .title {
            font-size: 1.1em;
            font-weight: 600;
            line-height: 1.4;
            margin: 5px 0;
            color: #333;
        }
        .blogger { font-size: 0.9em; color: #888; margin-top: auto; padding-top: 10px; }
        
        footer {
            text-align: center;
            margin-top: 50px;
            color: #aaa;
            font-size: 0.9em;
        }
        
        #loader {
            text-align: center;
            padding: 20px;
            color: #888;
            font-style: italic;
            display: none;
        }
    </style>
</head>
<body>

<header>
    <img src="default.jpg" alt="Find Vegan Recipes Fast" class="logo-img">
    
    <div class="search-wrapper">
        <input type="text" id="searchInput" placeholder="Search pasta, tofu, soup...">
        <button id="clearBtn" title="Clear Search">‚úï</button>
    </div>

    <div class="controls">
        <button class="btn" id="mealsBtn" onclick="toggleCategory('meal')">üçù Meals Only</button>
        <button class="btn" id="sweetsBtn" onclick="toggleCategory('sweet')">üç™ Sweets Only</button>
        <button class="btn" onclick="shuffleRecipes()">üîÄ Shuffle</button>

        <a href="shop.html" class="btn" style="text-decoration:none; color:#555;">üî™ Top 10 Vegan Kitchen Tools</a>
                
        <button class="btn" id="installBtn">üì≤ Install App</button>
    </div>
</header>

<div id="gallery" class="gallery">
    <!-- Recipes load here -->
</div>
<div id="loader">Loading more recipes...</div>

<footer>
    <p>Updated daily. Images belong to respective authors.</p>
</footer>

<script>
    // --- GLOBAL STATE ---
    let allRecipes = [];          
    let currentContext = [];      
    let renderedCount = 0;        
    let activeCategory = null;    
    const BATCH_SIZE = 48;        

    // --- KEYWORDS ---
    const SWEET_KEYWORDS = [
        'cookie', 'cake', 'brownie', 'chocolate', 'dessert', 'pie', 'tart', 
        'muffin', 'donut', 'doughnut', 'ice cream', 'pudding', 'cheesecake', 
        'sweet', 'fudge', 'truffle', 'bar', 'cupcake', 'blondie', 'galette',
        'cobbler', 'mousse', 'cinnamon roll', 'scone', 'waffle', 'pancake'
    ];

    const MEAL_KEYWORDS = [
        'pasta', 'burger', 'curry', 'soup', 'stew', 'taco', 'pizza', 'sandwich', 
        'wrap', 'salad', 'bowl', 'rice', 'noodle', 'stir fry', 'lasagna', 
        'casserole', 'tofu', 'tempeh', 'lentil', 'chickpea', 'potato', 'dinner', 
        'lunch', 'roast', 'chili', 'shepherd', 'risotto', 'gnocchi', 'quiche', 
        'enchilada', 'burrito', 'quesadilla', 'mac and cheese', 'dumpling', 
        'meatball', 'loaf', 'skillet', 'gratin', 'pad thai', 'ramen'
    ];

    // --- INITIALIZATION ---
    fetch('data.json')
        .then(response => response.json())
        .then(data => {
            allRecipes = data;
            currentContext = allRecipes; 
            renderNextBatch();           
            setupInfiniteScroll();       
        })
        .catch(error => {
            console.error('Error loading data:', error);
            document.getElementById('gallery').innerHTML = '<p style="text-align:center">Could not load recipes.</p>';
        });

    // --- RENDER LOGIC (BATCHED) ---
    function renderNextBatch() {
        const gallery = document.getElementById('gallery');
        const loader = document.getElementById('loader');
        
        if (renderedCount >= currentContext.length) {
            loader.style.display = 'none';
            return;
        }

        const nextBatch = currentContext.slice(renderedCount, renderedCount + BATCH_SIZE);
        
        nextBatch.forEach(recipe => {
            const card = createCard(recipe);
            gallery.appendChild(card);
        });

        renderedCount += nextBatch.length;
        
        if (renderedCount < currentContext.length) {
            loader.style.display = 'block';
        } else {
            loader.style.display = 'none';
        }
    }

    function createCard(recipe) {
        const card = document.createElement('a');
        card.className = 'card';
        card.href = recipe.link;
        card.target = "_blank"; 

        const img = document.createElement('img');
        
        // --- NEW: IMAGE OPTIMIZATION ---
        // We use images.weserv.nl to resize the image on the fly.
        // w=400: Resize to 400px width (perfect for grid)
        // q=80: Quality 80% (saves data)
        // output=webp: Modern fast format
        // url=: The original blogger's image URL
        const optimizedImage = `https://images.weserv.nl/?url=${encodeURIComponent(recipe.image)}&w=400&q=80&output=webp`;
        
        img.src = optimizedImage;
        
        // Fallback: If the proxy fails or image is broken, use your icon
        img.onerror = function() { 
            this.onerror = null; // Prevent infinite loop
            this.src = 'icon.jpg'; 
        };
        
        img.loading = "lazy"; 

        const info = document.createElement('div');
        info.className = 'info';

        let tagClass = 'tag';
        let tagText = 'Top Blog';
        if(recipe.is_disruptor) {
            tagClass += ' disruptor-tag';
            tagText = 'Rising Blog';
        }

        const recipeDate = new Date(recipe.date);
        const now = new Date();
        const daysOld = (now - recipeDate) / (1000 * 3600 * 24);
        
        let newBadge = '';
        if(daysOld < 2) {
            newBadge = '<span class="fresh-badge">NEW!</span>';
        }

        info.innerHTML = `
            <div class="meta-row">
                <span class="${tagClass}">${tagText}</span> ${newBadge}
            </div>
            <div class="title">${recipe.title}</div>
            <div class="blogger">by ${recipe.blog_name}</div>
        `;

        const shareBtn = document.createElement('div');
        shareBtn.className = 'share-btn';
        shareBtn.innerHTML = `
        <svg viewBox="0 0 24 24">
            <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
        </svg>`;
        shareBtn.onclick = (e) => shareRecipe(e, recipe.title, recipe.link);

        card.appendChild(shareBtn);
        card.appendChild(img);
        card.appendChild(info);
        return card;
    }

    // --- INFINITE SCROLL HANDLER ---
    function setupInfiniteScroll() {
        window.addEventListener('scroll', () => {
            if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 500) {
                if (renderedCount < currentContext.length) {
                    renderNextBatch();
                }
            }
        });
    }

    // --- RESET VIEW FUNCTION ---
    function resetView(newContext) {
        currentContext = newContext;
        renderedCount = 0;
        document.getElementById('gallery').innerHTML = '';
        document.getElementById('searchInput').value = '';
        document.getElementById('clearBtn').style.display = 'none';
        renderNextBatch();
    }

    // --- SHUFFLE FUNCTION ---
    function shuffleRecipes() {
        for (let i = allRecipes.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [allRecipes[i], allRecipes[j]] = [allRecipes[j], allRecipes[i]];
        }
        activeCategory = null;
        document.getElementById('mealsBtn').classList.remove('active-filter');
        document.getElementById('sweetsBtn').classList.remove('active-filter');
        resetView(allRecipes);
    }

    // --- FILTER/SEARCH LOGIC ---
    function applyFilters() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        let filtered = allRecipes;

        if (term.length > 0) {
            filtered = filtered.filter(recipe => {
                const title = recipe.title.toLowerCase();
                const blogger = recipe.blog_name.toLowerCase();
                return title.includes(term) || blogger.includes(term);
            });
        }

        if (activeCategory === 'sweet') {
            filtered = filtered.filter(recipe => {
                const t = recipe.title.toLowerCase();
                const hasKeyword = SWEET_KEYWORDS.some(k => t.includes(k));
                const isSavory = t.includes('sweet potato') || t.includes('sweet and sour');
                return hasKeyword && !isSavory;
            });
        } else if (activeCategory === 'meal') {
            filtered = filtered.filter(recipe => {
                const t = recipe.title.toLowerCase();
                const hasKeyword = MEAL_KEYWORDS.some(k => t.includes(k));
                const isSide = t.includes('sauce') || t.includes('dressing') || t.includes('side');
                return hasKeyword && !isSide;
            });
        }

        currentContext = filtered;
        renderedCount = 0;
        document.getElementById('gallery').innerHTML = '';
        renderNextBatch();
    }

    // --- CATEGORY TOGGLE ---
    function toggleCategory(category) {
        const mealsBtn = document.getElementById('mealsBtn');
        const sweetsBtn = document.getElementById('sweetsBtn');

        if (activeCategory === category) {
            activeCategory = null;
            mealsBtn.classList.remove('active-filter');
            sweetsBtn.classList.remove('active-filter');
        } else {
            activeCategory = category;
            if(category === 'meal') {
                mealsBtn.classList.add('active-filter');
                sweetsBtn.classList.remove('active-filter');
            } else {
                sweetsBtn.classList.add('active-filter');
                mealsBtn.classList.remove('active-filter');
            }
        }
        applyFilters();
    }

    // --- SEARCH INPUT LISTENERS ---
    const searchInput = document.getElementById('searchInput');
    const clearBtn = document.getElementById('clearBtn');

    searchInput.addEventListener('keyup', () => {
        clearBtn.style.display = searchInput.value.length > 0 ? 'block' : 'none';
        applyFilters();
    });

    clearBtn.addEventListener('click', () => {
        searchInput.value = '';
        searchInput.focus();
        clearBtn.style.display = 'none';
        applyFilters();
    });

    // --- INSTALL & SHARE ---
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.style.display = 'inline-block';
    });
    installBtn.addEventListener('click', (e) => {
        installBtn.style.display = 'none';
        deferredPrompt.prompt();
        deferredPrompt = null;
    });

    function shareRecipe(e, title, link) {
        e.preventDefault(); 
        e.stopPropagation(); 
        if (navigator.share) {
            navigator.share({ title: title, url: link }).catch(console.error);
        } else {
            navigator.clipboard.writeText(link);
            alert("Link copied to clipboard!");
        }
    }
</script>

</body>
</html>
