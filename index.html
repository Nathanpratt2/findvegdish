<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Vegan Recipes Fast</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="icon" href="icon.jpg"> 
    <link rel="apple-touch-icon" href="icon.jpg">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 20px;
            padding-bottom: 60px;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo-img {
            max-width: 90%;
            width: 350px;
            height: auto;
            display: block;
            margin: 0 auto 15px auto;
        }

        /* Search Bar Wrapper */
        .search-wrapper {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 10px auto;
        }

        #searchInput {
            padding: 12px 45px 12px 20px;
            width: 100%;
            box-sizing: border-box;
            border-radius: 25px;
            border: 1px solid #ddd;
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            outline: none;
            transition: all 0.3s ease;
            color: #27ae60; 
            font-weight: 600;
        }
        #searchInput:focus {
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border-color: #27ae60;
        }
        #searchInput::placeholder {
            color: #aaa;
            font-weight: 400;
        }

        #clearBtn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 18px;
            color: #aaa;
            cursor: pointer;
            display: none;
            padding: 5px;
        }
        #clearBtn:hover { color: #555; }

        /* Controls Container */
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        /* General Button Style */
        .btn {
            padding: 10px 20px;
            border-radius: 25px;
            border: none;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s, background 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            color: #555;
            background-color: white;
            border: 1px solid #ddd;
        }
        .btn:active { transform: scale(0.95); }
        .btn:hover { background-color: #f0f0f0; }

        /* Specific Button Colors */
        .btn-surprise { 
            background-color: #f1c40f; 
            color: #2c3e50; 
            border: none;
        }
        .btn-surprise:hover { background-color: #f39c12; }

        /* Active State for Filter Buttons */
        .btn.active-filter {
            background-color: #2c3e50;
            color: white;
            border-color: #2c3e50;
        }

        #installBtn {
            display: none;
            background-color: #2c3e50;
            color: white;
            border: none;
        }

        /* Grid Layout */
        .gallery {
            column-count: 4;
            column-gap: 15px;
            max-width: 1400px;
            margin: 0 auto;
            margin-top: 30px;
        }
        
        @media (max-width: 1000px) { .gallery { column-count: 3; } }
        @media (max-width: 800px) { .gallery { column-count: 2; } }
        @media (max-width: 500px) { .gallery { column-count: 1; } }

        .card {
            background: white;
            border-radius: 12px;
            margin-bottom: 15px;
            break-inside: avoid;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            overflow: hidden;
            display: block;
            text-decoration: none;
            color: inherit;
            position: relative;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }
        .card img {
            width: 100%;
            display: block;
        }
        
        /* UPDATED: Share Icon (25% Bigger) */
        .share-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            /* Was 35px, increased by ~25% to 44px */
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 10;
            transition: transform 0.2s, background 0.2s;
        }
        .share-btn:hover { transform: scale(1.1); background-color: #f0f0f0; }
        .share-btn svg {
            /* Was 18px, increased to 22px */
            width: 22px;
            height: 22px;
            fill: #555;
        }

        .info { padding: 15px; }
        
        .tag {
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #27ae60; 
            font-weight: bold;
            margin-bottom: 5px;
            display: inline-block;
        }
        .disruptor-tag { color: #e67e22; }
        
        .fresh-badge {
            background-color: #ff4757;
            color: white;
            font-size: 0.7em;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 5px;
            vertical-align: middle;
            font-weight: bold;
            text-transform: uppercase;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .title {
            font-size: 1.1em;
            font-weight: 600;
            line-height: 1.4;
            margin: 5px 0;
            color: #333;
        }
        .blogger { font-size: 0.9em; color: #888; }
        
        footer {
            text-align: center;
            margin-top: 50px;
            color: #aaa;
            font-size: 0.9em;
        }
    </style>
</head>
<body>

<header>
    <img src="default.jpg" alt="Find Vegan Recipes Fast" class="logo-img">
    
    <!-- Search Bar -->
    <div class="search-wrapper">
        <input type="text" id="searchInput" placeholder="Search pasta, tofu, soup...">
        <button id="clearBtn" title="Clear Search">‚úï</button>
    </div>

    <!-- Controls: Meals, Sweets, Surprise, Install -->
    <div class="controls">
        <button class="btn" id="mealsBtn" onclick="toggleCategory('meal')">üçù Meals Only</button>
        <button class="btn" id="sweetsBtn" onclick="toggleCategory('sweet')">üç™ Sweets Only</button>
        
        <button class="btn btn-surprise" id="surpriseBtn" title="Random Recipe">
            üé≤ Surprise Me
        </button>
        
        <button class="btn" id="installBtn">üì≤ Install App</button>
    </div>
</header>

<div id="gallery" class="gallery">
    <p style="text-align:center; width:100%;">Loading fresh recipes...</p>
</div>

<footer>
    <p>Updated daily. Images belong to respective authors.</p>
</footer>

<script>
    let allRecipes = []; 
    let activeCategory = null; // 'meal', 'sweet', or null

    // --- SMART KEYWORDS ---
    // Keywords that define a "Sweet", but we verify it's not savory later
    const SWEET_KEYWORDS = [
        'cookie', 'cake', 'brownie', 'chocolate', 'dessert', 'pie', 'tart', 
        'muffin', 'donut', 'doughnut', 'ice cream', 'pudding', 'cheesecake', 
        'sweet', 'fudge', 'truffle', 'bar', 'cupcake', 'blondie', 'galette',
        'cobbler', 'mousse', 'cinnamon roll', 'scone', 'waffle', 'pancake'
    ];

    // Keywords that define a "Meal" (Main Dish)
    const MEAL_KEYWORDS = [
        'pasta', 'burger', 'curry', 'soup', 'stew', 'taco', 'pizza', 'sandwich', 
        'wrap', 'salad', 'bowl', 'rice', 'noodle', 'stir fry', 'lasagna', 
        'casserole', 'tofu', 'tempeh', 'lentil', 'chickpea', 'potato', 'dinner', 
        'lunch', 'roast', 'chili', 'shepherd', 'risotto', 'gnocchi', 'quiche', 
        'enchilada', 'burrito', 'quesadilla', 'mac and cheese', 'dumpling', 
        'meatball', 'loaf', 'skillet', 'gratin', 'pad thai', 'ramen'
    ];

    // --- CATEGORY TOGGLE LOGIC ---
    function toggleCategory(category) {
        const mealsBtn = document.getElementById('mealsBtn');
        const sweetsBtn = document.getElementById('sweetsBtn');
        const searchInput = document.getElementById('searchInput');

        // Toggle logic
        if (activeCategory === category) {
            // Turning it off
            activeCategory = null;
            mealsBtn.classList.remove('active-filter');
            sweetsBtn.classList.remove('active-filter');
        } else {
            // Turning new one on
            activeCategory = category;
            
            // Visual updates
            if(category === 'meal') {
                mealsBtn.classList.add('active-filter');
                sweetsBtn.classList.remove('active-filter');
            } else {
                sweetsBtn.classList.add('active-filter');
                mealsBtn.classList.remove('active-filter');
            }
            
            // Clear text search to avoid conflicts
            searchInput.value = '';
            document.getElementById('clearBtn').style.display = 'none';
        }

        renderGrid(); // Re-run the filter logic
    }

    // --- MAIN FILTER/RENDER LOGIC ---
    function renderGrid() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        const cards = document.querySelectorAll('.card');
        
        cards.forEach(card => {
            const title = card.querySelector('.title').textContent.toLowerCase();
            const blogger = card.querySelector('.blogger').textContent.toLowerCase();
            let shouldShow = true;

            // 1. Text Search Filter
            if (term.length > 0) {
                if (!title.includes(term) && !blogger.includes(term)) {
                    shouldShow = false;
                }
            }

            // 2. Category Filter (Smart Logic)
            if (activeCategory && shouldShow) {
                if (activeCategory === 'sweet') {
                    // It IS a sweet if it has a keyword...
                    const hasKeyword = SWEET_KEYWORDS.some(k => title.includes(k));
                    // ...BUT it is NOT a sweet if it's "Sweet Potato" or "Sweet and Sour"
                    const isSavory = title.includes('sweet potato') || title.includes('sweet and sour');
                    
                    if (!hasKeyword || isSavory) shouldShow = false;

                } else if (activeCategory === 'meal') {
                    // It IS a meal if it has a keyword...
                    const hasKeyword = MEAL_KEYWORDS.some(k => title.includes(k));
                    // ...AND it doesn't sound like a side dish
                    const isSide = title.includes('sauce') || title.includes('dressing') || title.includes('side');
                    
                    if (!hasKeyword || isSide) shouldShow = false;
                }
            }

            card.style.display = shouldShow ? 'block' : 'none';
        });
    }

    // --- SURPRISE BUTTON ---
    document.getElementById('surpriseBtn').addEventListener('click', () => {
        if(allRecipes.length > 0) {
            const randomRecipe = allRecipes[Math.floor(Math.random() * allRecipes.length)];
            window.open(randomRecipe.link, '_blank');
        }
    });

    // --- INSTALL BUTTON ---
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.style.display = 'inline-block';
    });
    installBtn.addEventListener('click', (e) => {
        installBtn.style.display = 'none';
        deferredPrompt.prompt();
        deferredPrompt = null;
    });

    // --- SHARE FUNCTION ---
    function shareRecipe(e, title, link) {
        e.preventDefault(); 
        e.stopPropagation(); 

        if (navigator.share) {
            navigator.share({
                title: title,
                url: link
            }).catch(console.error);
        } else {
            navigator.clipboard.writeText(link);
            alert("Link copied to clipboard!");
        }
    }

    // --- MAIN FETCH ---
    fetch('data.json')
        .then(response => response.json())
        .then(data => {
            allRecipes = data;
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = ''; 

            data.forEach(recipe => {
                const card = document.createElement('a');
                card.className = 'card';
                card.href = recipe.link;
                card.target = "_blank"; 

                // Image Handling
                const img = document.createElement('img');
                img.src = recipe.image;
                img.onerror = function() { this.src = 'icon.jpg'; };
                img.loading = "lazy"; 

                // Info & Tags
                const info = document.createElement('div');
                info.className = 'info';

                let tagClass = 'tag';
                let tagText = 'Top Blog';
                if(recipe.is_disruptor) {
                    tagClass += ' disruptor-tag';
                    tagText = 'Rising Blog';
                }

                const recipeDate = new Date(recipe.date);
                const now = new Date();
                const daysOld = (now - recipeDate) / (1000 * 3600 * 24);
                let newBadge = '';
                if(daysOld < 2) newBadge = '<span class="fresh-badge">NEW!</span>';

                info.innerHTML = `
                    <span class="${tagClass}">${tagText}</span> ${newBadge}
                    <div class="title">${recipe.title}</div>
                    <div class="blogger">by ${recipe.blog_name}</div>
                `;

                // Share Button (Updated Size)
                const shareBtn = document.createElement('div');
                shareBtn.className = 'share-btn';
                shareBtn.innerHTML = `
                <svg viewBox="0 0 24 24">
                    <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
                </svg>`;
                
                shareBtn.onclick = (e) => shareRecipe(e, recipe.title, recipe.link);

                card.appendChild(shareBtn);
                card.appendChild(img);
                card.appendChild(info);
                gallery.appendChild(card);
            });

            // --- SEARCH EVENTS ---
            const searchInput = document.getElementById('searchInput');
            const clearBtn = document.getElementById('clearBtn');

            searchInput.addEventListener('keyup', () => {
                // If typing, reset categories for clarity
                if(activeCategory && searchInput.value.length > 0) {
                   toggleCategory(activeCategory); // Toggles it off
                }
                
                // Show/Hide Clear Button
                clearBtn.style.display = searchInput.value.length > 0 ? 'block' : 'none';
                
                renderGrid();
            });

            clearBtn.addEventListener('click', () => {
                searchInput.value = '';
                searchInput.focus();
                clearBtn.style.display = 'none';
                renderGrid();
            });
        })
        .catch(error => {
            console.error('Error loading data:', error);
            document.getElementById('gallery').innerHTML = '<p>Could not load recipes. Please try again later.</p>';
        });
</script>

</body>
</html>
